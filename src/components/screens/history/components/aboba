import React, { useMemo } from "react";
import { useQuery } from "react-query";
import { useAuth } from "../../../hooks/useAuth";
import historyService from "../../../services/history.service";
import { format } from "date-fns";
import { MantineReactTable } from 'mantine-react-table';
import { BsDownload } from 'react-icons/bs'; // Импортируем иконку загрузки

const HistoryTable = () => {
  const { user } = useAuth();
  
  const { data: currentData = [] } = useQuery(
    ["getHistoryByUserId", user.decode.sub],
    () => historyService.getHistoryByUserId(user.decode.sub),
    { select: ({ data }) => data }
  );

  const columns = useMemo(() => [
    { accessorKey: "resultValue", header: "Результат" },
    { accessorKey: "value3", header: "Абсолютная погрешность [Δ]" },
    { accessorKey: "value2", header: "Результат измерений X" },
    { accessorKey: "value1", header: "Разрядность" },
    { accessorKey: "uncertaintyBType", header: "Неопределённость по типу В" },
    { accessorKey: "uncertaintyTotal", header: "Суммарная неопределённость" },
    { accessorKey: "uncertaintyExpanded", header: "Расширенная неопределённость" },
    {
      accessorKey: "createdAt",
      header: "Дата",
      Cell: ({ cell }) => format(new Date(cell.getValue()), "dd/MM/yyyy HH:mm"),
    },
  ], []);

  const handleDownload = () => {
    // Здесь можно добавить логику для скачивания данных
    console.log('Скачивание данных...'); // Пример логики
  };

  const table = useMantineReactTable({
    columns,
    data: currentData,
  });

  return (
    <div className="p-4">
      <button
        onClick={handleDownload}
        className="mb-4 flex items-center bg-blue-600 text-white rounded-md py-2 px-4 hover:bg-blue-700 transition"
      >
        <BsDownload className="mr-2" />
        Скачать
      </button>
      <MantineReactTable table={table} />
    </div>
  );
};

export default HistoryTable;

